<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏–∑ –ø–æ–¥–∞—Ä–∫–æ–≤ Telegram</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <form action="/update" method="post">
        <button class="refresh-btn" type="submit">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </form>

    <div class="settings">
        <label for="exchangeRate">–ö—É—Ä—Å 1 TON –≤ –∑–≤—ë–∑–¥–∞—Ö:</label>
        <input type="number" id="exchangeRate" value="1" step="any">
        <label for="currencySelect">–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ü–µ–Ω—ã –≤:</label>
        <select id="currencySelect">
            <option value="ton">TON</option>
            <option value="stars">–ó–≤–µ–∑–¥—ã</option>
        </select>
    </div>
    <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ –ø–æ–¥–∞—Ä–∫–∏ Telegram</h2>
    <table>
        <thead>
            <tr>
                <th>üéÅ –ü–æ–¥–∞—Ä–æ–∫ Telegram</th>
                <th id="thermosHeader">üí∞ –¶–µ–Ω–∞ –Ω–∞ Thermos (TON)</th>
                <th id="tgmarketHeader">üìà –¶–µ–Ω–∞ –Ω–∞ TG Market (‚≠ê)</th>
                <th>üìä –†–∞–∑–Ω–∏—Ü–∞ (%)</th>
            </tr>
        </thead>
        <tbody>
            {% for gift in gifts %}
            <tr data-ton="{{ gift.thermos_price }}" data-stars="{{ gift.tgmarket_price }}">
                <td>{{ gift.tg_name }}</td>
                <td class="thermos-price"></td>
                <td class="tgmarket-price"></td>
                <td class="delta"></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        function updatePrices() {
            const rateInput = document.getElementById('exchangeRate');
            const select = document.getElementById('currencySelect');
            const rate = parseFloat(rateInput.value) || 1;
            const currency = select.value;

            document.getElementById('thermosHeader').textContent = `üí∞ –¶–µ–Ω–∞ –Ω–∞ Thermos (${currency === 'ton' ? 'TON' : '‚≠ê'})`;
            document.getElementById('tgmarketHeader').textContent = `üìà –¶–µ–Ω–∞ –Ω–∞ TG Market (${currency === 'ton' ? 'TON' : '‚≠ê'})`;

            document.querySelectorAll('tbody tr').forEach(row => {
                const ton = parseFloat(row.dataset.ton);
                const stars = parseFloat(row.dataset.stars);
                let thermosPrice, tgPrice;

                if (currency === 'ton') {
                    thermosPrice = ton;
                    tgPrice = stars / rate;
                } else {
                    thermosPrice = ton * rate;
                    tgPrice = stars;
                }

                row.querySelector('.thermos-price').textContent = thermosPrice.toFixed(2);
                row.querySelector('.tgmarket-price').textContent = tgPrice.toFixed(2);

                const deltaCell = row.querySelector('.delta');
                if (thermosPrice) {
                    const delta = ((tgPrice - thermosPrice) / thermosPrice * 100).toFixed(2);
                    deltaCell.textContent = `${delta}%`;
                    deltaCell.className = 'delta ' + (delta >= 0 ? 'positive' : 'negative');
                } else {
                    deltaCell.textContent = '-';
                    deltaCell.className = 'delta';
                }
            });
        }

        document.getElementById('exchangeRate').addEventListener('input', updatePrices);
        document.getElementById('currencySelect').addEventListener('change', updatePrices);
        window.addEventListener('DOMContentLoaded', updatePrices);
    </script>
</body>
</html>
